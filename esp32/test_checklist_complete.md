# ESP32 Isolation Sphere 統合テストチェックリスト

## 実施優先順序とステータス管理

### 🔴 Phase -1: 環境準備【即実施必須】

#### ESP-IDF環境確認
- [ ] **ENV_001**: ESP-IDF v5.1.2以上インストール確認
  ```bash
  idf.py --version
  ```
- [ ] **ENV_002**: ESP32S3ターゲット設定成功
  ```bash
  idf.py set-target esp32s3
  ```
- [ ] **ENV_003**: USB-UART接続認識（/dev/ttyUSB0 or /dev/ttyACM0）
- [ ] **ENV_004**: test_hello_worldフラッシュ書き込み成功
- [ ] **ENV_005**: シリアルモニターでログ確認

#### ハードウェア基本確認
- [ ] **HW_001**: PSRAM 8MB認識確認
- [ ] **HW_002**: GPIO制御（LED点滅）動作
- [ ] **HW_003**: 電源電圧3.3V±5%確認
- [ ] **HW_004**: デュアルコア動作確認
- [ ] **HW_005**: フラッシュサイズ確認（4MB以上）

### 🟡 Phase 0: アルゴリズム検証【1週間】

#### 球面マッピング比較
- [ ] **ALG_001**: 正距円筒図法の実装と性能測定
- [ ] **ALG_002**: キューブマップ投影の実装と評価
- [ ] **ALG_003**: 直接球面サンプリングの実装
- [ ] **ALG_004**: 各アルゴリズムのLUTサイズ比較
- [ ] **ALG_005**: 最適アルゴリズム選定とドキュメント化

#### LED座標データ準備
- [ ] **CSV_001**: LED座標CSVフォーマット定義
- [ ] **CSV_002**: 800個のLED座標データ生成
- [ ] **CSV_003**: ストリップID（0-3）割り当て
- [ ] **CSV_004**: 座標データ検証ツール作成
- [ ] **CSV_005**: SPIFFSへのCSVファイル格納

#### 姿勢補正検証
- [ ] **POSE_001**: Madgwickフィルタ実装
- [ ] **POSE_002**: Quaternion正規化処理
- [ ] **POSE_003**: ジンバルロック回避確認

### 🟢 Phase 1: 基本機能実装【2週間】

#### I2C通信（BNO055）
- [ ] **UT_IMU_001**: I2C初期化（400kHz）
- [ ] **UT_IMU_002**: BNO055接続確認（アドレス0x28/0x29）
- [ ] **UT_IMU_003**: Quaternion読み取り（100Hz）
- [ ] **UT_IMU_004**: キャリブレーション実行
- [ ] **UT_IMU_005**: NVSへのキャリブレーションデータ保存

#### SPI通信（ディスプレイ）
- [ ] **UT_SPI_001**: GC9A01ラウンドディスプレイ初期化
- [ ] **UT_SPI_002**: テストパターン表示
- [ ] **UT_SPI_003**: 画像転送速度測定
- [ ] **UT_SPI_004**: DMA転送動作確認
- [ ] **UT_SPI_005**: RP2350向けプロトコル実装

#### 基本エラー処理
- [ ] **ERR_001**: I2Cタイムアウト処理
- [ ] **ERR_002**: SPIエラーリトライ
- [ ] **ERR_003**: メモリ不足時の処理
- [ ] **ERR_004**: ウォッチドッグタイマー設定

### 🔵 Phase 2: ROS2通信実装【3週間】

#### micro-ROS環境構築
- [ ] **UT_ROS_001**: micro-ROS Humbleセットアップ
- [ ] **UT_ROS_002**: WiFi接続確立
- [ ] **UT_ROS_003**: ROS2 Agent接続
- [ ] **UT_ROS_004**: トピック購読（/video/frame）
- [ ] **UT_ROS_005**: トピック発行（/imu/quaternion）

#### 画像処理
- [ ] **UT_JPEG_001**: JPEGハードウェアデコーダ初期化
- [ ] **UT_JPEG_002**: 320x160画像展開（5ms以内）
- [ ] **UT_JPEG_003**: ダブルバッファリング実装
- [ ] **UT_JPEG_004**: PSRAMバッファ管理
- [ ] **UT_JPEG_005**: 破損データ処理

#### 通信統合
- [ ] **IT_LINK_001**: ROS2→JPEG→表示チェーン
- [ ] **IT_LINK_002**: IMU→ROS2送信チェーン
- [ ] **IT_LINK_003**: UIコマンド処理
- [ ] **IT_LINK_004**: QoS設定確認

### ⚪ Phase 3: 統合・最適化【2週間】

#### 球面マッピング実装
- [ ] **UT_SPHERE_001**: 選定アルゴリズム実装
- [ ] **UT_SPHERE_002**: IMU姿勢補正適用
- [ ] **UT_SPHERE_003**: LED RGB値計算
- [ ] **UT_SPHERE_004**: 補間処理最適化
- [ ] **UT_SPHERE_005**: LUT高速化

#### システム統合
- [ ] **IT_E2E_001**: 完全処理フロー（33ms以内）
- [ ] **IT_E2E_002**: 30fps連続動作確認
- [ ] **IT_E2E_003**: 姿勢追従精度測定（±1度）
- [ ] **BOOT_001**: 起動時間測定（10秒以内）
- [ ] **BOOT_002**: 自動接続・初期化シーケンス

#### 性能最適化
- [ ] **PT_TIME_001**: 各処理ステージ時間測定
- [ ] **PT_CPU_001**: Core 0使用率（目標60%）
- [ ] **PT_CPU_002**: Core 1使用率（目標70%）
- [ ] **PT_MEM_001**: メモリ使用量最適化
- [ ] **PT_MEM_002**: メモリリーク確認

### ⚫ Phase 4: 品質保証【2週間】

#### 長時間安定性
- [ ] **PT_LOAD_001**: 24時間連続動作テスト
- [ ] **PT_LOAD_002**: 72時間耐久テスト
- [ ] **LIMIT_001**: メモリリーク監視
- [ ] **LIMIT_002**: 温度上昇測定

#### フェイルセーフ機能
- [ ] **AT_ERR_001**: WiFi切断→デモモード移行
- [ ] **AT_ERR_002**: IMU異常→固定表示
- [ ] **AT_ERR_003**: 画像未受信→最終フレーム保持
- [ ] **AT_ERR_004**: 自動再接続機能

#### セキュリティ・品質
- [ ] **SEC_001**: 不正JPEG処理
- [ ] **SEC_002**: バッファオーバーフロー防止
- [ ] **CODE_001**: 静的解析（cppcheck）
- [ ] **CODE_002**: コードカバレッジ80%達成

#### 最終検証
- [ ] **AT_FUNC_001**: 全機能動作確認
- [ ] **AT_UX_001**: 映像品質確認（ちらつきなし）
- [ ] **AT_UX_002**: 姿勢追従性（遅延感なし）
- [ ] **AT_OPS_001**: 発熱確認（60℃以下）

### 📊 Phase 5: リリース準備【1週間】

#### ドキュメント整備
- [ ] **DOC_001**: APIドキュメント生成
- [ ] **DOC_002**: ビルド手順書作成
- [ ] **DOC_003**: トラブルシューティングガイド
- [ ] **DOC_004**: パフォーマンスレポート

#### OTA・保守機能
- [ ] **OTA_001**: OTA更新機能実装
- [ ] **OTA_002**: ロールバック機能
- [ ] **LOG_001**: ログ機能実装
- [ ] **PROF_001**: プロファイリング機能

## テスト実行コマンド集

### 基本テスト実行
```bash
# 環境確認
cd /home/yakatano/work/isolation-sphere/esp32/test_hello_world
idf.py build flash monitor

# 単体テスト
cd /home/yakatano/work/isolation-sphere/esp32
idf.py test

# カバレッジ測定
idf.py coverage
```

### 性能測定
```bash
# CPU使用率監視
idf.py monitor | grep "CPU:"

# メモリ使用量監視
idf.py size
idf.py size-components
```

### デバッグ
```bash
# GDBデバッグ
idf.py gdb

# コアダンプ解析
idf.py coredump-info

# 静的解析
cppcheck --enable=all --suppress=missingIncludeSystem .
```

## 進捗管理

### 週次レビュー項目
- [ ] テスト実施数/合格数
- [ ] 発見不具合数/修正数
- [ ] コードカバレッジ推移
- [ ] 性能指標達成状況

### リスク項目
- [ ] PSRAMが認識されない場合の対処
- [ ] WiFi接続が不安定な場合の対処
- [ ] 処理時間が目標を超過した場合の対処
- [ ] メモリ不足が発生した場合の対処

## 完了基準

### リリース判定基準
- [ ] 全Critical/Highテスト合格
- [ ] コードカバレッジ80%以上
- [ ] 24時間連続動作成功
- [ ] 性能目標95%達成
- [ ] 重大な不具合ゼロ

---
最終更新: 2024年
バージョン: 1.0.0
このチェックリストは定期的に見直し、更新すること。